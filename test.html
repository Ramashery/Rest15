<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Диагностика сайта VinoElite</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #1a1a1a; 
            color: #f5f5f5; 
            padding: 20px; 
            margin: 0;
        }
        h1 { 
            color: #c19a6b; 
            border-bottom: 1px solid #c19a6b;
            padding-bottom: 10px;
        }
        #test-results {
            list-style: none;
            padding: 0;
            font-size: 16px;
            line-height: 1.8;
        }
        #test-results li {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 8px;
            word-wrap: break-word;
        }
        .success { background-color: #28a74533; border-left: 4px solid #28a745; }
        .error { background-color: #dc354533; border-left: 4px solid #dc3545; }
        .pending { background-color: #ffc10733; border-left: 4px solid #ffc107; }
        .info { background-color: #17a2b833; border-left: 4px solid #17a2b8; }
        code {
            background-color: #000;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: "Courier New", Courier, monospace;
        }
    </style>
</head>
<body>

    <h1>Диагностика сайта VinoElite</h1>
    <p>Этот файл проверяет ключевые компоненты вашего сайта. Отправьте результат разработчику.</p>
    <ul id="test-results">
        <!-- Результаты тестов появятся здесь -->
    </ul>

    <script type="module">
        // Импортируем все необходимые функции Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, collection, getDocs, query, limit } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        const resultsList = document.getElementById('test-results');

        // Функция для добавления результата в список на странице
        function addResult(status, message) {
            const li = document.createElement('li');
            li.className = status; // success, error, pending, info
            li.innerHTML = (status === 'success' ? '✅ ' : status === 'error' ? '❌ ' : '⏳ ') + message;
            resultsList.appendChild(li);
        }

        // --- НАЧАЛО ТЕСТИРОВАНИЯ ---
        try {
            // Тест 1: Запуск JavaScript
            addResult('success', 'Тест 1: JavaScript успешно запущен.');

            // Тест 2: Загрузка библиотек Firebase
            if (typeof initializeApp === 'function' && typeof getFirestore === 'function') {
                addResult('success', 'Тест 2: Библиотеки Firebase успешно загружены.');
            } else {
                addResult('error', 'Тест 2: НЕ удалось загрузить библиотеки Firebase. Проверьте подключение к интернету.');
                throw new Error("Остановка тестов: Firebase не загружен.");
            }

            // Тест 3: Инициализация Firebase
            let db;
            try {
                const firebaseConfig = {
                    apiKey: "AIzaSyBflzOWVf3HgDpdUhha3qvyeUJf7i6dOuk",
                    authDomain: "wine-91d0e.firebaseapp.com",
                    projectId: "wine-91d0e",
                    storageBucket: "wine-91d0e.firebasestorage.app",
                    messagingSenderId: "1021620433427",
                    appId: "1:1021620433427:web:5439252fb350c4455a85e6",
                    measurementId: "G-TRWHY3KXK1"
                };
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                addResult('success', 'Тест 3: Приложение Firebase успешно инициализировано с проектом <code>wine-91d0e</code>.');
            } catch (e) {
                addResult('error', 'Тест 3: Ошибка при инициализации Firebase: ' + e.message);
                throw new Error("Остановка тестов: Ошибка инициализации.");
            }

            // Тест 4: Подключение к базе данных и получение данных
            addResult('pending', 'Тест 4: Пытаюсь получить данные из коллекции "products"...');
            try {
                const q = query(collection(db, "products"), limit(1));
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    addResult('error', 'Тест 4: Ошибка! Коллекция <code>products</code> пуста или не найдена. Проверьте, что в базе данных Firestore есть коллекция с названием "products" и в ней есть хотя бы один документ.');
                } else {
                    const productData = querySnapshot.docs[0].data();
                    addResult('success', 'Тест 4: Успешно! Получен как минимум один товар из базы данных. Это значит, что подключение работает и правила безопасности разрешают чтение.');
                    addResult('info', 'Пример полученных данных: <code>' + JSON.stringify(productData).substring(0, 100) + '...</code>');
                }
            } catch (e) {
                addResult('error', 'Тест 4: Ошибка при получении данных из Firestore: ' + e.message + '. <strong>Это самая частая проблема.</strong> Вероятнее всего, нужно проверить <strong>Правила (Rules)</strong> в вашей базе данных Firestore. Они должны разрешать чтение коллекции `products`.');
            }

            // Тест 5: Проверка наличия ключевых HTML-элементов
            addResult('info', 'Тест 5: Теперь проверьте, что в ваших HTML-файлах (<code>index.html</code>, <code>catalog.html</code>) есть следующие элементы для вставки контента:');
            const checkList = document.createElement('ul');
            checkList.innerHTML = `
                <li>Для <code>index.html</code>: <code>&lt;section id="hero-section"&gt;</code></li>
                <li>Для <code>catalog.html</code>: <code>&lt;div id="filters-container"&gt;</code></li>
                <li>Для <code>product.html</code>: <code>&lt;div class="product-container"&gt;</code></li>
            `;
            const li = document.createElement('li');
            li.appendChild(checkList);
            resultsList.appendChild(li);


        } catch (error) {
            addResult('error', 'КРИТИЧЕСКАЯ ОШИБКА: ' + error.message);
        }

    </script>

</body>
</html>