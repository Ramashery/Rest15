<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VinoElite - Firebase Test</title>
    <style>
        body { font-family: monospace; background-color: #121212; color: #e0e0e0; padding: 15px; }
        h1 { color: #c19a6b; }
        .log { margin-bottom: 10px; padding: 10px; border-left: 3px solid; }
        .log.info { border-color: #3498db; background-color: #1f2c35; }
        .log.success { border-color: #2ecc71; background-color: #1c3628; }
        .log.error { border-color: #e74c3c; background-color: #3c2121; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>
    <h1>Firebase Connection Test</h1>
    <div id="results"></div>

    <script type="module">
        // Импортируем необходимые модули Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, getDoc, limit, query } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        const resultsContainer = document.getElementById('results');

        function log(message, type = 'info') {
            const p = document.createElement('p');
            p.className = `log ${type}`;
            p.innerHTML = `<strong>[${type.toUpperCase()}]</strong> ${message}`;
            resultsContainer.appendChild(p);
        }

        log("Script started. Initializing Firebase...");

        try {
            const firebaseConfig = {
              apiKey: "AIzaSyBflzOWVf3HgDpdUhha3qvyeUJf7i6dOuk",
              authDomain: "wine-91d0e.firebaseapp.com",
              projectId: "wine-91d0e",
              storageBucket: "wine-91d0e.firebasestorage.app",
              messagingSenderId: "1021620433427",
              appId: "1:1021620433427:web:5439252fb350c4455a85e6",
              measurementId: "G-TRWHY3KXK1"
            };

            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            log("Firebase app initialized successfully.", "success");

            // --- TEST 1: Fetching Hero Content ---
            log("Attempting to fetch Hero content from 'siteContent/hero'...");
            const heroDocRef = doc(db, "siteContent", "hero");
            getDoc(heroDocRef)
                .then(docSnap => {
                    if (docSnap.exists()) {
                        log("Successfully fetched Hero content.", "success");
                        const data = docSnap.data();
                        log(`<pre>${JSON.stringify(data, null, 2)}</pre>`, "info");
                    } else {
                        log("Could not find document 'siteContent/hero'. Make sure the collection and document names are correct.", "error");
                    }
                })
                .catch(error => {
                    log("Error fetching Hero content. This is likely a Firestore Rules issue.", "error");
                    log(`Error details: ${error.message}`, "error");
                });

            // --- TEST 2: Fetching Products ---
            log("Attempting to fetch 1 product from 'products' collection...");
            const productsQuery = query(collection(db, "products"), limit(1));
            getDocs(productsQuery)
                .then(querySnapshot => {
                    if (querySnapshot.empty) {
                        log("The 'products' collection is empty or does not exist.", "error");
                    } else {
                        log(`Successfully fetched ${querySnapshot.size} product(s).`, "success");
                        querySnapshot.forEach(doc => {
                            const data = doc.data();
                            log(`Product ID: ${doc.id}`, "info");
                            log(`<pre>${JSON.stringify(data, null, 2)}</pre>`, "info");
                        });
                    }
                })
                .catch(error => {
                    log("Error fetching products. This is very likely a Firestore Rules issue.", "error");
                    log(`Error details: ${error.message}`, "error");
                });

        } catch (e) {
            log("A critical error occurred during Firebase initialization.", "error");
            log(`Error details: ${e.message}`, "error");
        }
    </script>
</body>
</html>